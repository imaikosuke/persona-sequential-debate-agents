---
globs: *.ts
alwaysApply: false
---
# ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã§ã™ã€‚

## TypeScript

### åŸºæœ¬æ–¹é‡

- **å‹å®‰å…¨æ€§ã‚’æœ€å„ªå…ˆ**: `any`ã®ä½¿ç”¨ã¯é¿ã‘ã‚‹
- **å³æ ¼ãªå‹ãƒã‚§ãƒƒã‚¯**: `tsconfig.json`ã®`strict`ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ç”¨
- **æ˜ç¤ºçš„ãªå‹å®šç¾©**: é–¢æ•°ã®æˆ»ã‚Šå€¤ã®å‹ã¯æ˜ç¤ºçš„ã«å®šç¾©

### å‹å®šç¾©

```typescript
// âœ… Good: æ˜ç¤ºçš„ãªå‹å®šç¾©
function processData(input: string): Promise<Result> {
  // ...
}

// âŒ Bad: å‹æ¨è«–ã«é ¼ã‚Šã™ã
function processData(input) {
  // ...
}
```

### Zodã‚¹ã‚­ãƒ¼ãƒã®æ´»ç”¨

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å…¥å‡ºåŠ›ã«ã¯Zodã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©ï¼š

```typescript
import { z } from "zod";

// Zodã‚¹ã‚­ãƒ¼ãƒã®å®šç¾©
export const inputSchema = z.object({
  topic: z.string().min(1),
  maxSteps: z.number().int().positive().default(10),
  tokenBudget: z.number().int().positive().default(10000),
});

// TypeScriptå‹ã®å°å‡º
export type Input = z.infer<typeof inputSchema>;
```

### Nullableãªå€¤ã®æ‰±ã„

```typescript
// âœ… Good: Optional chainingã¨Nullish coalescing
const value = obj?.property ?? defaultValue;

// âŒ Bad: æ‰‹å‹•ã§ãƒã‚§ãƒƒã‚¯
const value = obj && obj.property ? obj.property : defaultValue;
```

## ãƒ•ã‚¡ã‚¤ãƒ«å‘½åè¦å‰‡

### TypeScriptãƒ•ã‚¡ã‚¤ãƒ«

- **ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ**: `*-agent.ts` (ä¾‹: `deliberative-agent.ts`)
- **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**: `*-workflow.ts` (ä¾‹: `argumentation-workflow.ts`)
- **ã‚¹ãƒ†ãƒƒãƒ—**: `*-step.ts` (ä¾‹: `initialize-step.ts`)
- **ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£**: ç›®çš„ã«å¿œã˜ãŸå‘½å (ä¾‹: `blackboard.ts`, `persona-utils.ts`)
- **å‹å®šç¾©**: å˜æ•°å½¢ã¾ãŸã¯è¤‡æ•°å½¢ (ä¾‹: `blackboard.ts`, `types.ts`)
- **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ**: `prompts.ts` ã¾ãŸã¯ `index.ts`

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå‘½å

- **ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹**: ã™ã¹ã¦å°æ–‡å­—ã€ãƒã‚¤ãƒ•ãƒ³åŒºåˆ‡ã‚Š
- **è¤‡æ•°å½¢ã®ä½¿ç”¨**: `agents/`, `workflows/`, `steps/`, `prompts/`

## Import/Exportè¦å‰‡

### Named Exportsã‚’ä½¿ç”¨

```typescript
// âœ… Good: Named exports
export const myAgent = new Agent({ ... });
export function utilityFunction() { ... }

// âŒ Bad: Default exportï¼ˆç‰¹åˆ¥ãªç†ç”±ãŒãªã„é™ã‚Šï¼‰
export default myAgent;
```

### index.tsã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚’æ•´ç†

å„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`index.ts`ã‚’é…ç½®ã—ã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚’æ•´ç†ï¼š

```typescript
// agents/index.ts
export * from "./deliberative-agent";
export * from "./executor-agent";
export * from "./judge-agent";
```

### Importé †åº

ESLintã®`simple-import-sort`ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«å¾“ã†ï¼š

1. Node.jsãƒ“ãƒ«ãƒˆã‚¤ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
2. å¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
3. å†…éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆ`@/`ã‚„`./`ï¼‰
4. å‹ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

```typescript
import { readFile } from "fs/promises";

import { Agent } from "@mastra/core";
import { z } from "zod";

import { myAgent } from "./agents";
import type { BlackboardState } from "./types";
```

## ã‚³ãƒ¡ãƒ³ãƒˆ

### æ—¥æœ¬èªã‚³ãƒ¡ãƒ³ãƒˆ

- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯æ—¥æœ¬èªä¸­å¿ƒã®ãŸã‚ã€ã‚³ãƒ¡ãƒ³ãƒˆã¯æ—¥æœ¬èªã‚’ä½¿ç”¨
- è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã«ã¯å¿…ãšèª¬æ˜ã‚’è¿½åŠ 

```typescript
// âœ… Good: è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã«æ—¥æœ¬èªã‚³ãƒ¡ãƒ³ãƒˆ
// åæŸã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—: ä¿¡å¿µåæŸåº¦ã¨æ”»æ’ƒè§£æ±ºç‡ã®å¹³å‡
const convergenceScore = (beliefConvergence + attackResolution) / 2;

// âœ… Good: é–¢æ•°ã®ç›®çš„ã‚’èª¬æ˜
/**
 * ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒ¼ãƒ‰ã«æ–°ã—ã„ä¸»å¼µã‚’è¿½åŠ ã™ã‚‹
 * @param state ç¾åœ¨ã®ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒ¼ãƒ‰çŠ¶æ…‹
 * @param claim è¿½åŠ ã™ã‚‹ä¸»å¼µ
 * @returns æ›´æ–°ã•ã‚ŒãŸãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒ¼ãƒ‰çŠ¶æ…‹
 */
export function addClaim(state: BlackboardState, claim: Claim): BlackboardState {
  // ...
}
```

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### Try-Catchã®ä½¿ç”¨

```typescript
// âœ… Good: é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
export const myStep = new Step({
  id: "myStep",
  execute: async ({ context }) => {
    try {
      const result = await riskyOperation(context);
      return { success: true, result };
    } catch (error) {
      console.error("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:", error);
      return {
        success: false,
        error: error instanceof Error ? error.message : "Unknown error",
      };
    }
  },
});
```

### ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

- å…·ä½“çš„ã§ç†è§£ã—ã‚„ã™ã„ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- ãƒ‡ãƒãƒƒã‚°ã«å¿…è¦ãªæƒ…å ±ã‚’å«ã‚ã‚‹

```typescript
// âœ… Good: è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
throw new Error(`ä¸»å¼µ ${claimId} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ç¾åœ¨ã®ä¸»å¼µæ•°: ${claims.length}`);

// âŒ Bad: æ›–æ˜§ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
throw new Error("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ");
```

## ãƒ­ã‚°å‡ºåŠ›

### ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

```typescript
// âœ… Good: æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ­ã‚°
console.log("\n" + "=".repeat(80));
console.log("ğŸ”µ ã‚¹ãƒ†ãƒƒãƒ—é–‹å§‹: Initialize");
console.log("ãƒˆãƒ”ãƒƒã‚¯:", topic);
console.log("=".repeat(80) + "\n");

// âœ… Good: JSONãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§è©³ç´°å‡ºåŠ›
console.log("ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒ¼ãƒ‰çŠ¶æ…‹:", JSON.stringify(state, null, 2));
```

### ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®ä½¿ã„åˆ†ã‘

```typescript
console.log("é€šå¸¸ã®æƒ…å ±"); // ä¸€èˆ¬çš„ãªæƒ…å ±
console.warn("è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"); // è­¦å‘Šï¼ˆå‡¦ç†ã¯ç¶™ç¶šï¼‰
console.error("ã‚¨ãƒ©ãƒ¼:", error); // ã‚¨ãƒ©ãƒ¼ï¼ˆå‡¦ç†å¤±æ•—ï¼‰
```

## éåŒæœŸå‡¦ç†

### Async/Awaitã‚’ä½¿ç”¨

```typescript
// âœ… Good: async/await
async function processWorkflow() {
  const result = await agent.generate(prompt);
  return result.text;
}

// âŒ Bad: Promise chainï¼ˆè¤‡é›‘ãªå ´åˆï¼‰
function processWorkflow() {
  return agent.generate(prompt).then(result => result.text);
}
```

### Promise.allã®æ´»ç”¨

ä¸¦åˆ—å®Ÿè¡Œå¯èƒ½ãªå‡¦ç†ã¯`Promise.all`ã‚’ä½¿ç”¨ï¼š

```typescript
// âœ… Good: ä¸¦åˆ—å®Ÿè¡Œ
const [result1, result2, result3] = await Promise.all([
  agent1.generate(prompt1),
  agent2.generate(prompt2),
  agent3.generate(prompt3),
]);
```

## ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

### Prettierã®è¨­å®š

- **ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆ**: 2ã‚¹ãƒšãƒ¼ã‚¹
- **ã‚»ãƒŸã‚³ãƒ­ãƒ³**: ã‚ã‚Š
- **ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆ**: true
- **æœ«å°¾ã‚«ãƒ³ãƒ**: ES5äº’æ›

### è¡Œã®é•·ã•

- **æ¨å¥¨**: 80æ–‡å­—ä»¥å†…
- **æœ€å¤§**: 120æ–‡å­—
- é•·ã„è¡Œã¯é©åˆ‡ã«æ”¹è¡Œ

```typescript
// âœ… Good: é©åˆ‡ãªæ”¹è¡Œ
const result = await myAgent.generate(generatePrompt(topic, context), { schema: outputSchema });

// âŒ Bad: é•·ã™ãã‚‹è¡Œ
const result = await myAgent.generate(generatePrompt(topic, context), { schema: outputSchema });
```

## ãƒ†ã‚¹ãƒˆã¨ãƒã‚§ãƒƒã‚¯

### ã‚³ãƒŸãƒƒãƒˆå‰ã®å¿…é ˆãƒã‚§ãƒƒã‚¯

```bash
make lint-fix     # ãƒªãƒ³ãƒˆè‡ªå‹•ä¿®æ­£
make format-fix   # ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè‡ªå‹•ä¿®æ­£
make typecheck    # å‹ãƒã‚§ãƒƒã‚¯
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

### ä¸è¦ãªè¨ˆç®—ã®å›é¿

```typescript
// âœ… Good: ãƒ¡ãƒ¢åŒ–
const expensiveResult = useMemo(() => {
  return expensiveCalculation(input);
}, [input]);

// âœ… Good: æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³
if (!isValid(input)) {
  return defaultValue;
}
```

### ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ã®æœ€é©åŒ–

- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ç°¡æ½”ã«
- ä¸è¦ãªæƒ…å ±ã¯é™¤å¤–
- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’æ„è­˜

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### ç’°å¢ƒå¤‰æ•°ã®ç®¡ç†

```typescript
// âœ… Good: ç’°å¢ƒå¤‰æ•°ã®ãƒã‚§ãƒƒã‚¯
const apiKey = process.env.OPENAI_API_KEY;
if (!apiKey) {
  throw new Error("OPENAI_API_KEY is not set");
}

// âŒ Bad: ç›´æ¥ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰
const apiKey = "sk-..."; // çµ¶å¯¾ã«ã—ãªã„ï¼
```
# ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã§ã™ã€‚

## TypeScript

### åŸºæœ¬æ–¹é‡

- **å‹å®‰å…¨æ€§ã‚’æœ€å„ªå…ˆ**: `any`ã®ä½¿ç”¨ã¯é¿ã‘ã‚‹
- **å³æ ¼ãªå‹ãƒã‚§ãƒƒã‚¯**: `tsconfig.json`ã®`strict`ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ç”¨
- **æ˜ç¤ºçš„ãªå‹å®šç¾©**: é–¢æ•°ã®æˆ»ã‚Šå€¤ã®å‹ã¯æ˜ç¤ºçš„ã«å®šç¾©

### å‹å®šç¾©

```typescript
// âœ… Good: æ˜ç¤ºçš„ãªå‹å®šç¾©
function processData(input: string): Promise<Result> {
  // ...
}

// âŒ Bad: å‹æ¨è«–ã«é ¼ã‚Šã™ã
function processData(input) {
  // ...
}
```

### Zodã‚¹ã‚­ãƒ¼ãƒã®æ´»ç”¨

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å…¥å‡ºåŠ›ã«ã¯Zodã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©ï¼š

```typescript
import { z } from "zod";

// Zodã‚¹ã‚­ãƒ¼ãƒã®å®šç¾©
export const inputSchema = z.object({
  topic: z.string().min(1),
  maxSteps: z.number().int().positive().default(10),
  tokenBudget: z.number().int().positive().default(10000),
});

// TypeScriptå‹ã®å°å‡º
export type Input = z.infer<typeof inputSchema>;
```

### Nullableãªå€¤ã®æ‰±ã„

```typescript
// âœ… Good: Optional chainingã¨Nullish coalescing
const value = obj?.property ?? defaultValue;

// âŒ Bad: æ‰‹å‹•ã§ãƒã‚§ãƒƒã‚¯
const value = obj && obj.property ? obj.property : defaultValue;
```

## ãƒ•ã‚¡ã‚¤ãƒ«å‘½åè¦å‰‡

### TypeScriptãƒ•ã‚¡ã‚¤ãƒ«

- **ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ**: `*-agent.ts` (ä¾‹: `deliberative-agent.ts`)
- **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**: `*-workflow.ts` (ä¾‹: `argumentation-workflow.ts`)
- **ã‚¹ãƒ†ãƒƒãƒ—**: `*-step.ts` (ä¾‹: `initialize-step.ts`)
- **ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£**: ç›®çš„ã«å¿œã˜ãŸå‘½å (ä¾‹: `blackboard.ts`, `persona-utils.ts`)
- **å‹å®šç¾©**: å˜æ•°å½¢ã¾ãŸã¯è¤‡æ•°å½¢ (ä¾‹: `blackboard.ts`, `types.ts`)
- **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ**: `prompts.ts` ã¾ãŸã¯ `index.ts`

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå‘½å

- **ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹**: ã™ã¹ã¦å°æ–‡å­—ã€ãƒã‚¤ãƒ•ãƒ³åŒºåˆ‡ã‚Š
- **è¤‡æ•°å½¢ã®ä½¿ç”¨**: `agents/`, `workflows/`, `steps/`, `prompts/`

## Import/Exportè¦å‰‡

### Named Exportsã‚’ä½¿ç”¨

```typescript
// âœ… Good: Named exports
export const myAgent = new Agent({ ... });
export function utilityFunction() { ... }

// âŒ Bad: Default exportï¼ˆç‰¹åˆ¥ãªç†ç”±ãŒãªã„é™ã‚Šï¼‰
export default myAgent;
```

### index.tsã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚’æ•´ç†

å„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`index.ts`ã‚’é…ç½®ã—ã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚’æ•´ç†ï¼š

```typescript
// agents/index.ts
export * from "./deliberative-agent";
export * from "./executor-agent";
export * from "./judge-agent";
```

### Importé †åº

ESLintã®`simple-import-sort`ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«å¾“ã†ï¼š

1. Node.jsãƒ“ãƒ«ãƒˆã‚¤ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
2. å¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
3. å†…éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆ`@/`ã‚„`./`ï¼‰
4. å‹ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

```typescript
import { readFile } from "fs/promises";

import { Agent } from "@mastra/core";
import { z } from "zod";

import { myAgent } from "./agents";
import type { BlackboardState } from "./types";
```

## ã‚³ãƒ¡ãƒ³ãƒˆ

### æ—¥æœ¬èªã‚³ãƒ¡ãƒ³ãƒˆ

- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯æ—¥æœ¬èªä¸­å¿ƒã®ãŸã‚ã€ã‚³ãƒ¡ãƒ³ãƒˆã¯æ—¥æœ¬èªã‚’ä½¿ç”¨
- è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã«ã¯å¿…ãšèª¬æ˜ã‚’è¿½åŠ 

```typescript
// âœ… Good: è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã«æ—¥æœ¬èªã‚³ãƒ¡ãƒ³ãƒˆ
// åæŸã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—: ä¿¡å¿µåæŸåº¦ã¨æ”»æ’ƒè§£æ±ºç‡ã®å¹³å‡
const convergenceScore = (beliefConvergence + attackResolution) / 2;

// âœ… Good: é–¢æ•°ã®ç›®çš„ã‚’èª¬æ˜
/**
 * ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒ¼ãƒ‰ã«æ–°ã—ã„ä¸»å¼µã‚’è¿½åŠ ã™ã‚‹
 * @param state ç¾åœ¨ã®ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒ¼ãƒ‰çŠ¶æ…‹
 * @param claim è¿½åŠ ã™ã‚‹ä¸»å¼µ
 * @returns æ›´æ–°ã•ã‚ŒãŸãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒ¼ãƒ‰çŠ¶æ…‹
 */
export function addClaim(state: BlackboardState, claim: Claim): BlackboardState {
  // ...
}
```

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### Try-Catchã®ä½¿ç”¨

```typescript
// âœ… Good: é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
export const myStep = new Step({
  id: "myStep",
  execute: async ({ context }) => {
    try {
      const result = await riskyOperation(context);
      return { success: true, result };
    } catch (error) {
      console.error("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:", error);
      return {
        success: false,
        error: error instanceof Error ? error.message : "Unknown error",
      };
    }
  },
});
```

### ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

- å…·ä½“çš„ã§ç†è§£ã—ã‚„ã™ã„ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- ãƒ‡ãƒãƒƒã‚°ã«å¿…è¦ãªæƒ…å ±ã‚’å«ã‚ã‚‹

```typescript
// âœ… Good: è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
throw new Error(`ä¸»å¼µ ${claimId} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ç¾åœ¨ã®ä¸»å¼µæ•°: ${claims.length}`);

// âŒ Bad: æ›–æ˜§ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
throw new Error("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ");
```

## ãƒ­ã‚°å‡ºåŠ›

### ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

```typescript
// âœ… Good: æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ­ã‚°
console.log("\n" + "=".repeat(80));
console.log("ğŸ”µ ã‚¹ãƒ†ãƒƒãƒ—é–‹å§‹: Initialize");
console.log("ãƒˆãƒ”ãƒƒã‚¯:", topic);
console.log("=".repeat(80) + "\n");

// âœ… Good: JSONãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§è©³ç´°å‡ºåŠ›
console.log("ãƒ–ãƒ©ãƒƒã‚¯ãƒœãƒ¼ãƒ‰çŠ¶æ…‹:", JSON.stringify(state, null, 2));
```

### ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®ä½¿ã„åˆ†ã‘

```typescript
console.log("é€šå¸¸ã®æƒ…å ±"); // ä¸€èˆ¬çš„ãªæƒ…å ±
console.warn("è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"); // è­¦å‘Šï¼ˆå‡¦ç†ã¯ç¶™ç¶šï¼‰
console.error("ã‚¨ãƒ©ãƒ¼:", error); // ã‚¨ãƒ©ãƒ¼ï¼ˆå‡¦ç†å¤±æ•—ï¼‰
```

## éåŒæœŸå‡¦ç†

### Async/Awaitã‚’ä½¿ç”¨

```typescript
// âœ… Good: async/await
async function processWorkflow() {
  const result = await agent.generate(prompt);
  return result.text;
}

// âŒ Bad: Promise chainï¼ˆè¤‡é›‘ãªå ´åˆï¼‰
function processWorkflow() {
  return agent.generate(prompt).then(result => result.text);
}
```

### Promise.allã®æ´»ç”¨

ä¸¦åˆ—å®Ÿè¡Œå¯èƒ½ãªå‡¦ç†ã¯`Promise.all`ã‚’ä½¿ç”¨ï¼š

```typescript
// âœ… Good: ä¸¦åˆ—å®Ÿè¡Œ
const [result1, result2, result3] = await Promise.all([
  agent1.generate(prompt1),
  agent2.generate(prompt2),
  agent3.generate(prompt3),
]);
```

## ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

### Prettierã®è¨­å®š

- **ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆ**: 2ã‚¹ãƒšãƒ¼ã‚¹
- **ã‚»ãƒŸã‚³ãƒ­ãƒ³**: ã‚ã‚Š
- **ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆ**: true
- **æœ«å°¾ã‚«ãƒ³ãƒ**: ES5äº’æ›

### è¡Œã®é•·ã•

- **æ¨å¥¨**: 80æ–‡å­—ä»¥å†…
- **æœ€å¤§**: 120æ–‡å­—
- é•·ã„è¡Œã¯é©åˆ‡ã«æ”¹è¡Œ

```typescript
// âœ… Good: é©åˆ‡ãªæ”¹è¡Œ
const result = await myAgent.generate(generatePrompt(topic, context), { schema: outputSchema });

// âŒ Bad: é•·ã™ãã‚‹è¡Œ
const result = await myAgent.generate(generatePrompt(topic, context), { schema: outputSchema });
```

## ãƒ†ã‚¹ãƒˆã¨ãƒã‚§ãƒƒã‚¯

### ã‚³ãƒŸãƒƒãƒˆå‰ã®å¿…é ˆãƒã‚§ãƒƒã‚¯

```bash
make lint-fix     # ãƒªãƒ³ãƒˆè‡ªå‹•ä¿®æ­£
make format-fix   # ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè‡ªå‹•ä¿®æ­£
make typecheck    # å‹ãƒã‚§ãƒƒã‚¯
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

### ä¸è¦ãªè¨ˆç®—ã®å›é¿

```typescript
// âœ… Good: ãƒ¡ãƒ¢åŒ–
const expensiveResult = useMemo(() => {
  return expensiveCalculation(input);
}, [input]);

// âœ… Good: æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³
if (!isValid(input)) {
  return defaultValue;
}
```

### ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ã®æœ€é©åŒ–

- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ç°¡æ½”ã«
- ä¸è¦ãªæƒ…å ±ã¯é™¤å¤–
- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’æ„è­˜

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### ç’°å¢ƒå¤‰æ•°ã®ç®¡ç†

```typescript
// âœ… Good: ç’°å¢ƒå¤‰æ•°ã®ãƒã‚§ãƒƒã‚¯
const apiKey = process.env.OPENAI_API_KEY;
if (!apiKey) {
  throw new Error("OPENAI_API_KEY is not set");
}

// âŒ Bad: ç›´æ¥ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰
const apiKey = "sk-..."; // çµ¶å¯¾ã«ã—ãªã„ï¼
```
